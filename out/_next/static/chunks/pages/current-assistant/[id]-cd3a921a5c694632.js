(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[761],{1252:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/current-assistant/[id]",function(){return n(8307)}])},8307:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var r=n(5893),a=n(7294),o=n(1163),s=n(8236),i=n(5861),l=n(5616),c=n(9417),u=n(1664),d=n.n(u),x=e=>{let{assistant:t}=e;return(0,r.jsxs)(l.Z,{children:[(0,r.jsx)(i.Z,{variant:"h5",children:t.name}),(0,r.jsx)(i.Z,{variant:"subtitle1",children:t.description})]})},h=e=>{let{conversationHistory:t}=e;return(0,r.jsx)(r.Fragment,{children:t.map((e,t)=>(0,r.jsx)(l.Z,{sx:{padding:"10px 20px",borderRadius:"20px",backgroundColor:"question"===e.type?"#e0f7fa":"#b2ebf2",maxWidth:"80%",marginLeft:"question"===e.type?"auto":"10px",marginRight:"question"===e.type?"10px":"auto",marginTop:"10px",border:"none",boxShadow:"0 2px 5px rgba(0,0,0,0.1)"},children:(0,r.jsx)(i.Z,{color:"question"===e.type?"primary":"secondary",children:e.text})},t))})},p=n(8579),f=e=>{let{inputText:t,setInputText:n,handleSendClick:a}=e;return(0,r.jsxs)(r.Fragment,{children:[" ",(0,r.jsx)(p.Z,{fullWidth:!0,label:"Your question",variant:"outlined",value:t,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),a())},margin:"normal"}),(0,r.jsx)(c.Z,{variant:"contained",color:"primary",onClick:a,style:{marginBottom:"20px"},children:"Send                  "})]})},g=e=>{let{src:t,onAudioData:n}=e,r=(0,a.useRef)(null),o=(0,a.useRef)(null),s=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(!r.current){let e=new Audio(t);r.current=e;let n=new(window.AudioContext||window.webkitAudioContext);o.current=n;let a=n.createAnalyser();a.fftSize=256,s.current=a,n.createMediaElementSource(e).connect(a),a.connect(n.destination)}let e=()=>{if(s.current){let e=new Uint8Array(s.current.frequencyBinCount);s.current.getByteFrequencyData(e),n(new Uint8Array(e))}requestAnimationFrame(e)};return r.current.play().catch(e=>console.error("Playback error:",e)),e(),()=>{r.current&&(r.current.pause(),r.current.src=""),o.current&&o.current.close(),r.current=null,o.current=null,s.current=null}},[t,n]),null},y=e=>{let{dataArray:t}=e,n=50-(t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0)/255*150;return(0,r.jsx)(l.Z,{sx:{width:"".concat(50,"px"),height:"".concat(50,"px"),overflow:"hidden",border:"1px solid black",backgroundColor:"#eee"},children:(0,r.jsx)("svg",{width:"100%",height:"100%",children:(0,r.jsx)("line",{x1:"0",y1:n.toFixed(2),x2:"100%",y2:n.toFixed(2),stroke:"rgba(75, 192, 192, 1)",strokeWidth:"2"})})})},j=n(5121);let m=async e=>{let{text:t,voiceName:n,apiKey:r}=e,a=function(e,t){let n=atob(e),r=Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);let a=new Uint8Array(r);return new Blob([a],{type:t})}((await j.Z.post("https://texttospeech.googleapis.com/v1beta1/text:synthesize?key=".concat(r),{input:{text:t},voice:{languageCode:"fr-CA",name:n,ssmlGender:"MALE"},audioConfig:{audioEncoding:"MP3"}},{responseType:"json"})).data.audioContent,"audio/mp3");return URL.createObjectURL(a)};var w=n(3454);n(9738).config(),console.log("APIKEY: "+w.env.REACT_APP_GOOGLE_CLOUD_API_KEY);let b="AIzaSyBVHf9S6j4i_w47s8bl9PO5K39dQ6bg96U",C=async e=>({assistant:(await j.Z.get("http://localhost:3001/assistants/".concat(e))).data}),v=async(e,t,n,r)=>{let a={type:"question",text:e};n(a);let o={contents:[{role:"user",parts:[{text:(null==t?void 0:t.userRole)||"Default user role"}]},{role:"model",parts:[{text:(null==t?void 0:t.modelInfo)||"Default model info"}]},...r.concat(a).map(e=>({role:"question"===e.type?"user":"model",parts:[{text:e.text}]}))]};try{let e=await j.Z.post("".concat("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent","?key=").concat(b),o,{headers:{"Content-Type":"application/json"}}),t={type:"response",text:e.data.candidates[0].content.parts.map(e=>e.text).join(" ")};n(t);let r=await m({text:t.text,voiceName:"fr-CA-Neural2-B",apiKey:b});return{data:t,audioUrl:r}}catch(e){return console.error("API call failed:",e),{error:"API call failed"}}};var A=n(8032),Z=n(7078),k=n(594),S=()=>{let[e,t]=(0,a.useState)(!1),[n,o]=(0,a.useState)(""),[s,u]=(0,a.useState)([]),d=()=>{t(!e)};return(0,r.jsx)(l.Z,{sx:{position:"fixed",bottom:16,right:16,zIndex:1e3},children:e?(0,r.jsxs)(l.Z,{sx:{width:300,height:400,backgroundColor:"background.paper",boxShadow:3,borderRadius:2,padding:2,display:"flex",flexDirection:"column"},children:[(0,r.jsx)(c.Z,{onClick:d,sx:{alignSelf:"flex-end"},children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(i.Z,{variant:"h6",gutterBottom:!0,children:"Chat with Assistant"}),(0,r.jsx)(x,{assistant:{id:1,name:"Helper Bot",description:"I am here to assist you!",userRole:"Support",modelInfo:"Based on GPT-3"}}),(0,r.jsx)(h,{conversationHistory:s}),(0,r.jsx)(f,{inputText:n,setInputText:o,handleSendClick:()=>{u([...s,{type:"question",text:n}]),o("")}})]}):(0,r.jsx)(A.Z,{color:"primary",onClick:d,children:(0,r.jsx)(Z.Z,{})})})},_=()=>{let{id:e}=(0,o.useRouter)().query,{conversationHistory:t,addChatBubble:n}=function(){let[e,t]=(0,a.useState)([]);return{conversationHistory:e,addChatBubble:e=>{t(t=>[...t,e])}}}(),[u,p]=(0,a.useState)(null),[j,m]=(0,a.useState)(""),[w,b]=(0,a.useState)(!0),[A,Z]=(0,a.useState)(""),[k,_]=(0,a.useState)(""),[E,q]=(0,a.useState)(new Uint8Array(128));(0,a.useEffect)(()=>{e&&C(e).then(e=>{p(e.assistant),b(!1)}).catch(e=>{Z("Failed to fetch assistant details"),console.error(e),b(!1)})},[e]);let B=async()=>{let e=await v(j,u,n,t);e&&e.error?Z(e.error):(m(""),e.audioUrl&&_(e.audioUrl))};return w?(0,r.jsx)("p",{children:"Loading..."}):A?(0,r.jsxs)("p",{children:["Error: ",A]}):(0,r.jsxs)(s.Z,{maxWidth:"sm",children:[(0,r.jsxs)(i.Z,{variant:"h4",gutterBottom:!0,children:["Assistant Details - ",null==u?void 0:u.name]}),u&&(0,r.jsxs)(l.Z,{children:[(0,r.jsx)(x,{assistant:u}),(0,r.jsx)(h,{conversationHistory:t}),(0,r.jsx)(f,{inputText:j,setInputText:m,handleSendClick:B}),(0,r.jsx)(d(),{href:"/",passHref:!0,children:(0,r.jsx)(c.Z,{variant:"contained",color:"secondary",children:"Back to List"})}),(0,r.jsx)(d(),{href:"/CreateAssistant",passHref:!0,children:(0,r.jsx)(c.Z,{variant:"contained",color:"secondary",children:"Create New Assistant"})}),k&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g,{src:k,onAudioData:q}),(0,r.jsx)(y,{dataArray:E})]})]}),(0,r.jsx)(S,{})," "]})}},6647:function(){}},function(e){e.O(0,[714,150,48,850,225,888,774,179],function(){return e(e.s=1252)}),_N_E=e.O()}]);