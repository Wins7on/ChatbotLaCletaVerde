(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[589],{3421:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chatbot",function(){return n(8928)}])},8928:function(e,t,n){"use strict";n.r(t);var o=n(5893),r=n(7294),i=n(7441);class s{async fetchDescription(){try{let e=await fetch("/description.txt");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.text();this.description=t,console.log("Description loaded:",this.description)}catch(e){console.error("Failed to load description:",e)}}escapeString(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'").replace(/\n/g,"").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}async sendMessage(e,t){let n={contents:[{role:"user",parts:[{text:"Salut"}]},{role:"model",parts:[{text:"Salut je suis Carlos reponsable de la s\xe9curit\xe9 chez La Cleta Verde."}]},{role:"user",parts:[{text:this.escapeString(this.description)+" Current date: Date actuelle: "+function(e){let[t,n,o]=e.split("-"),r=parseInt(o,10),i=["janvier","f\xe9vrier","mars","avril","mai","juin","juillet","ao\xfbt","septembre","octobre","novembre","d\xe9cembre"][parseInt(n,10)-1];return"".concat(r," ").concat(i," ").concat(t)}(new Date().toLocaleDateString())}]},...t.map(e=>({role:"question"===e.type?"user":"model",parts:[{text:this.escapeString(e.text)}]})),{role:"user",parts:[{text:this.escapeString(e)}]}],generationConfig:{temperature:.1,topP:.95,topK:64,maxOutputTokens:8192,responseMimeType:"text/plain"},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]};try{let e=await fetch("".concat(this.apiUrl,"?key=").concat(this.apiKey),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),t=await e.json();if(console.log("API response:",t),!t.candidates||!t.candidates[0]||!t.candidates[0].content)throw Error("Invalid API response structure");return t.candidates[0].content.parts.map(e=>e.text).join(" ")}catch(e){return console.error("Error:",e),"Error fetching response"}}constructor(){this.description="",this.apiKey="AIzaSyBVHf9S6j4i_w47s8bl9PO5K39dQ6bg96U",this.apiUrl="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro-latest:generateContent"}}let a={container:{position:"fixed",bottom:"20px",right:"20px",width:"475px",height:"647px",backgroundImage:"url(/lacletaverde.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",backgroundColor:"rgba(255, 255, 255, 1.0)",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"8px",padding:"10px",zIndex:1e3,overflow:"auto",display:"flex",flexDirection:"column"},containerMinimized:{width:"200px",height:"40px",overflow:"hidden"},header:{fontWeight:"bold",textAlign:"center",marginBottom:"10px",color:"#FFFFFF",backgroundColor:"#008000",padding:"10px",borderRadius:"8px 8px 0 0",display:"flex",justifyContent:"space-between",alignItems:"center"},minimizeButton:{backgroundColor:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"20px",lineHeight:"20px"},messages:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},typingIndicator:{color:"#666",fontStyle:"italic",margin:"10px 0",textAlign:"center"},inputContainer:{display:"flex",marginTop:"auto"},input:{flex:1,padding:"5px",border:"1px solid #ccc",borderRadius:"4px 0 0 4px"},button:{padding:"5px 10px",border:"none",backgroundColor:"#4CAF50",color:"white",borderRadius:"0 4px 4px 0",cursor:"pointer"},userBubble:{backgroundColor:"#e1ffc7",borderRadius:"10px",padding:"2px 5px",margin:"2px 0",alignSelf:"flex-end",maxWidth:"80%",textAlign:"right",color:"#005B96"},botBubble:{backgroundColor:"#f1f0f0",borderRadius:"10px",padding:"2px 5px",margin:"2px 0",alignSelf:"flex-start",maxWidth:"80%",color:"#005B96"},resizeHandle:{position:"absolute",top:"0",left:"0",width:"10px",height:"10px",backgroundColor:"#FFFFFF",cursor:"nwse-resize",zIndex:1001,borderTopLeftRadius:"8px"}};t.default=()=>{let[e,t]=(0,r.useState)([]),[n,l]=(0,r.useState)(""),[c,d]=(0,r.useState)([]),[p,u]=(0,r.useState)(null),[g,h]=(0,r.useState)(!1),[x,y]=(0,r.useState)(!1),f=(0,r.useRef)(null),m=(0,r.useRef)(null),b=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=new s;e.fetchDescription().then(()=>{u(e)});let t=document.createElement("video");return t.src="/carlostyping.mp4",t.autoplay=!0,t.loop=!0,t.muted=!0,t.playbackRate=.5,t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.objectFit="contain",t.style.zIndex="-1",t.style.backgroundColor="#002000",document.body.appendChild(t),document.body.style.height="100vh",document.body.style.margin="0",document.body.style.fontFamily="Arial, sans-serif",()=>{document.body.style.height="",document.body.style.margin="",document.body.style.fontFamily="",document.body.removeChild(t)}},[]),(0,r.useEffect)(()=>{let e=document.getElementById("messages");e&&(e.scrollTop=e.scrollHeight)},[e]);let w=async()=>{if(""!==n.trim()){let e={type:"question",text:n};if(t(t=>[...t,e]),d(t=>[...t,e]),l(""),p){y(!0);let o={type:"response",text:await p.sendMessage(n,[...c,e])};t(e=>[...e,o]),d(e=>[...e,o]),y(!1)}}},v=e=>{let t=e.replace(/(\n|^)(\* )/g,"$1\n$2");return{__html:(0,i.TU)(t)}};return(0,o.jsxs)("div",{ref:m,style:{...a.container,...g?a.containerMinimized:{}},children:[(0,o.jsx)("div",{ref:b,style:a.resizeHandle,onMouseDown:e=>{let t=m.current,n=b.current;if(t&&n&&e.target===n){let n=e.clientX,o=e.clientY,r=t.offsetWidth,i=t.offsetHeight,s=e=>{let s=r+(n-e.clientX),a=i+(o-e.clientY);t.style.width="".concat(s,"px"),t.style.height="".concat(a,"px")},a=()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",a)};window.addEventListener("mousemove",s),window.addEventListener("mouseup",a)}}}),(0,o.jsxs)("div",{style:a.header,children:[(0,o.jsx)("span",{children:"Assistant de La Cleta Verde"}),(0,o.jsx)("button",{onClick:()=>{h(!g)},style:a.minimizeButton,children:g?"\uD83D\uDD0D":"âž–"})]}),!g&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:a.messages,id:"messages",children:[e.map((e,t)=>(0,o.jsx)("div",{style:"question"===e.type?a.userBubble:a.botBubble,dangerouslySetInnerHTML:v(e.text)},t)),(0,o.jsx)("div",{ref:f}),x&&(0,o.jsx)("div",{style:a.typingIndicator,children:"L'assistant est en train d'\xe9crire..."})]}),(0,o.jsxs)("div",{style:a.inputContainer,children:[(0,o.jsx)("input",{type:"text",value:n,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey?"Enter"===e.key&&e.shiftKey&&(e.preventDefault(),l(n+"\n")):(e.preventDefault(),w())},placeholder:"Entrez votre message ici",style:a.input}),(0,o.jsx)("button",{onClick:w,style:a.button,children:"Envoyer"})]})]})]})}}},function(e){e.O(0,[441,888,774,179],function(){return e(e.s=3421)}),_N_E=e.O()}]);